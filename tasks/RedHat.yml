---

- name: Download Repository
  get_url:
    url: http://pkg.jenkins-ci.org/redhat/jenkins.repo
    dest: /etc/yum.repos.d/jenkins.repo

- name: Import Jenkins Package Key
  rpm_key:
    state: present
    key: https://jenkins-ci.org/redhat/jenkins-ci.org.key

- name: Install Jenkins
  package:
    name: jenkins
    state: present

- name: Apply Jenkins Config
  template:
    dest: /etc/sysconfig/jenkins
    owner: root
    group: root
    mode: 0600
    src: jenkins.j2

- name: Start Service
  service:
    name: jenkins
    state: started
  when: jenkins_service_start

- name: Enable Service
  service:
    name: jenkins
    enabled: "{{ jenkins_service_enable }}"

# - name: Enable Jenkins Firewall Ports
#   firewalld:
#     port: "{{ item }}"
#     permanent: true
#     state: enabled
#   with_items: jenkins_firewall_ports
#   when: jenkins_firewall_ports_enable
#
# - name: Enable Jenkins Firewall Services
#   firewalld:
#     service: "{{ item }}"
#     permanent: true
#     state: enabled
#   with_items: jenkins_firewall_services
#   when: jenkins_firewall_services_enable

- name: Find Files
  shell: find / -name "jenkins.war"
  register: __jenkins_war
  changed_when: false

- debug: var=__jenkins_war
  changed_when: false
